#summary API Design and Specification
#labels API,Phase-Support

Die [API] nutzt den [Application_Server Application Server].

== Allgemeines zur API ==
Der Cocktailberater bietet am Application Server eine Schnittstelle, die von verschiedenen Clients genutzt wird.

Die Kommunikation zum Application Server wird immer vom Client angestoßen. Jede Anfrage muss zu einer Antwort führen, die entweder Nutzdaten, oder eine Erfogs-/Misserfolgsmeldung beinhaltet. Der Server kann keine Events aussenden. Die Clients müssen gegebenfalls im Polling-Modus arbeiten. 

Der Application Server wird über http auf Port 80 angesprochen. Es wird ein php Script mit der HTTP-GET Methode aufgerufen. Dem Script werden Parameter übergeben.

Der Server liefert als Antwort eine Datei vom Typ text/xml zurück.

  * API-Sprache: Englisch
   * alle API-Namen sind Englisch, da cb international gehen will
   * Die Clients werden erstmal auf Deutsch sein, bis das Projekt international geht, wird es noch eine Weile dauern.
   * Die Anfragen können in jeder beliebigen Sprache lauten. Wenn ich z.B. nach Zutaten in Deutschland suche, und Zitronensaft angebe, dann bekomme ich auch Ergebnisse mit lemon-juice.
  * Fehlermeldungen sind standardmäßig in Deutsch, bei Angabe der Sprache (Parameter: /language/eng) kann sie aber auch übersetzt werden.

  * allgemein Anlehnung an die [http://www.flickr.com/services/api/ Flickr API]

  * sich wiederholende Phrasen
   * get-all: Suchen nach Cocktails / Kategorien / Usern / Tags (wenn nichts angegeben, werden alle ausgegeben)
    * z.B.: http://api.cocktailberater.de/services/rest/cocktail-get-all/name/Caipirinha
   * get: eine bestimmte Bestellung, Cocktail / etc. anhand der 'ID' zurückgeben
    * z.B.: http://api.cocktailberater.de/services/rest/cocktail-get/idcocktail/1

*Aufbau der GET Anfragen:*

  * Wurzel: http://api.cocktailberater.de/services/rest

/xxxx

anschließend können zusätzliche Parameter angehängt werden:

/xxx/parameter1/wert1/paramter2/wert2

Es soll eine Möglichkeit geben, alle API-Aufrufe mit Ausführungszeit zu protokollieren. Hauptsächlich für Statistik-  und Optimierungszwecke. Zusätzlich wird ein SLA was die Antwortzeit angeht festgeschrieben. Bei einer Verletzung soll eine E-Mail versendet werden.

  * in der XML-Datei dürfen keine HTML-Tags stehen

  * TODO:
   * nur die Cocktails anzeigen, welche auch erstellt werden können (anhand des Inventars)
   * Aufnahme der zugeordneten Cocktailbars in /api/getKunden
   * Volltextsuche noch unschärfer gestalten

==API-Explorer==
Der API-Explorer dient dem komfortablen Testen der API.

  * todo...

==API-Methoden==
=== Namensräume ===
[cb_category cb-category]
  * [cb_category_get cb-category-get] (maybe coming soon)
  * [cb_category_get_all cb-category-get-all]
  * [cb_category_add cb-category-add] (maybe coming soon)
  * [cb_category_update cb-category-update] (maybe coming soon)
  * [cb_category_remove cb-category-remove] (maybe coming soon)
[cb_cocktail cb-cocktail]
  * [cb_cocktail_get cb-cocktail-get]
  * [cb_cocktail_get_all cb-cocktail-get-all]
  * [cb_cocktail_add cb-cocktail-add] (maybe coming soon)
  * [cb_cocktail_update cb-cocktail-update] (maybe coming soon)
  * [cb_cocktail_remove cb-cocktail-remove] (maybe coming soon)
[cb_cocktail_party cb-cocktail-party]
  * [cb_cocktail_party_get cb-cocktail-party-get]
  * [cb_cocktail_party_get_all cb-cocktail-party-get-all]
  * [cb_cocktail_party_add cb-cocktail-party-add]
  * [cb_cocktail_party_update cb-cocktail-party-update] (maybe coming soon)
  * [cb_cocktail_party_remove cb-cocktail-party-remove] (maybe coming soon)
[cb_ingredient cb-ingredient]
  * [cb_ingredient_get cb-ingredient-get] (maybe coming soon)
  * [cb_ingredient_get_all cb-ingredient-get-all]
  * [cb_ingredient_add cb-ingredient-add] (maybe coming soon)
  * [cb_ingredient_remove cb-ingredient-remove] (maybe coming soon)
  * [cb_ingredient_update cb-ingredient-update] (maybe coming soon)
[cb_member cb-member]
  * [cb_member_get cb-member-get]
  * [cb_member_get_all cb-member-get-all] (maybe coming soon)
  * [cb_member_add cb-member-add]
  * [cb_member_update cb-member-update] (maybe coming soon)
  * [cb_member_remove cb-member-remove] (maybe coming soon)
  * [cb_member_checkout cb-member-checkout]
  * [cb_member_password_reset cb-member-password-reset]
  * [cb_member_photo_upload cb-member-photo-upload] (maybe coming soon)
[cb_menue cb-menue]
  * [cb_menue_get cb-menue-get]
  * [cb_menue_get_all cb-menue-get-all] (maybe coming soon)
  * [cb_menue_add cb-menue-add]
  * [cb_menue_update cb-menue-update] (maybe coming soon)
  * [cb_menue_remove cb-menue-remove] (maybe coming soon)
  * [cb_menue_recipe_add cb-menue-recipe-add]
  * [cb_menue_recipe_remove cb-menue-recipe-remove]
  * [cb_menue_recipe_price_set cb-menue-recipe-price-set]
[cb_order cb-order]
  * [cb_order_get cb-order-get]
  * [cb_order_get_all cb-order-get-all]
  * [cb_order_add cb-order-add]
  * [cb_order_update cb-order-update]
  * [cb_order_remove cb-order-remove] (aka cancel)
  * [cb_order_move cb-order-move]
  * [cb_order_complete cb-order-complete]
[cb_product cb-product]
  * [cb_product_get cb-product-get] (maybe coming soon)
  * [cb_product_get_all cb-product-get-all] (maybe coming soon)
  * [cb_product_add cb-product-add] (maybe coming soon)
  * [cb_product_update cb-product-update] (maybe coming soon)
  * [cb_product_remove cb-product-remove] (maybe coming soon)
[cb_recipe cb-recipe]
  * [cb_recipe_get cb-recipe-get] (maybe coming soon)
  * [cb_recipe_get_all cb-recipe-get-all] (maybe coming soon)
  * [cb_recipe_add cb-recipe-add] (maybe coming soon)
  * [cb_recipe_update cb-recipe-update] (maybe coming soon)
  * [cb_recipe_remove cb-recipe-remove] (maybe coming soon)
[cb_test cb-test]
  * [cb_test_echo cb-test-echo]

=== Fehlermeldungen ===
Fehlermeldungen haben immer folgendes Format:
{{{
<?xml version="1.0" encoding="utf-8" ?>
 <rsp stat="fail">
   <err code="1001" msg="The database is currently not available" />
</rsp>
}}}

Übersetzungen der Fehlercodes können wie folgt abgerufen werden:
  * Anfrage: http://www.cocktailberater.de/api/error-code-translate/code/1001/language/de
  * Beispielantwort bei Erfolg:
{{{
<?xml version="1.0" encoding="utf-8" ?>
 <rsp stat="ok">
   <err code="1001" msg="Die Datenbank ist zur Zeit nicht verfügbar." />
 </rsp>
}}}

Übersicht aller [Fehlercodes]